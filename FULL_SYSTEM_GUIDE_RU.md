# üåä WaveSens - –ü–û–õ–ù–´–ô –°–ò–°–¢–ï–ú–ù–´–ô –ì–ê–ô–î

**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ –∫–ª—é—á–∞–º–∏, URL, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º–∏ –∏ –±–∞–≥–∞–º–∏**

–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2025-10-02

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
2. [–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Ñ–∞–π–ª–æ–≤–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [API –∫–ª—é—á–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#api-–∫–ª—é—á–∏-–∏-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
4. [Railway –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç](#railway-–¥–µ–ø–ª–æ–π–º–µ–Ω—Ç)
5. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-postgresql)
6. [–ë–ª–æ–∫ 1: News Analyzer](#–±–ª–æ–∫-1-news-analyzer)
7. [–ë–ª–æ–∫ 2: Signal Extractor](#–±–ª–æ–∫-2-signal-extractor)
8. [–ë–ª–æ–∫ 3: Experiment Manager](#–±–ª–æ–∫-3-experiment-manager)
9. [Frontend Dashboard](#frontend-dashboard)
10. [Backend API Server](#backend-api-server)
11. [–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤](#–∏—Å—Ç–æ—Ä–∏—è-–∏–∑–º–µ–Ω–µ–Ω–∏–π-–∏-—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤)
12. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏ –∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–±–∞–≥–∏-–∏-–∏—Ö-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
13. [–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è](#—Ç–∏–ø–∏—á–Ω—ã–µ-–æ—à–∏–±–∫–∏-–∏-—Ä–µ—à–µ–Ω–∏—è)

---

## –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

WaveSens - —ç—Ç–æ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª—å–Ω–∞—è** —Ç–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑ –º–æ–∫–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è —Ç–µ–æ—Ä–∏—é –≤–æ–ª–Ω–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≠–ª–ª–∏–æ—Ç—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         WAVESENS ARCHITECTURE                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

   Internet                   Railway Cloud
      ‚îÇ
      ‚îÇ                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ                  ‚îÇ   PostgreSQL Database        ‚îÇ
      ‚îÇ                  ‚îÇ   (Railway Postgres)         ‚îÇ
      ‚îÇ                  ‚îÇ                              ‚îÇ
      ‚îÇ                  ‚îÇ   Tables:                    ‚îÇ
      ‚îÇ                  ‚îÇ   - news_items               ‚îÇ
      ‚îÇ                  ‚îÇ   - trading_signals          ‚îÇ
      ‚îÇ                  ‚îÇ   - experiments              ‚îÇ
      ‚îÇ                  ‚îÇ   - portfolio_snapshots      ‚îÇ
      ‚îÇ                  ‚îÇ   - service_logs             ‚îÇ
      ‚îÇ                  ‚îÇ                              ‚îÇ
      ‚îÇ                  ‚îÇ   Triggers:                  ‚îÇ
      ‚îÇ                  ‚îÇ   - notify_new_significant_news‚îÇ
      ‚îÇ                  ‚îÇ   - notify_new_signal        ‚îÇ
      ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ                           ‚îÇ
      ‚îÇ                           ‚îÇ LISTEN/NOTIFY
      ‚îÇ                           ‚îÇ
      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ      ‚îÇ          ‚îÇ                   ‚îÇ           ‚îÇ
      ‚ñº      ‚ñº          ‚ñº                   ‚ñº           ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇFinn‚îÇ ‚îÇOpen‚îÇ    ‚îÇNews‚îÇ              ‚îÇSig ‚îÇ      ‚îÇExp ‚îÇ
  ‚îÇhub ‚îÇ ‚îÇRou ‚îÇ    ‚îÇAna ‚îÇ              ‚îÇExt ‚îÇ      ‚îÇMgr ‚îÇ
  ‚îÇAPI ‚îÇ ‚îÇter ‚îÇ    ‚îÇlyz ‚îÇ   NOTIFY     ‚îÇrac ‚îÇ      ‚îÇ    ‚îÇ
  ‚îÇ    ‚îÇ ‚îÇAPI ‚îÇ    ‚îÇer  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇtor ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ    ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò  new_sig_news‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò new_sig‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ                   ‚îÇ              ‚îÇ
                      ‚îÇ                   ‚îÇ              ‚îÇ
                  Gets news          Analyzes       Executes
                  from Finnhub       waves with     virtual
                  Filters with       Claude AI      trades
                  Claude AI          Generates      Monitors
                                     signals        positions
                                                         ‚îÇ
                                                         ‚îÇ
                                                         ‚ñº
                                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                    ‚îÇYahoo   ‚îÇ
                                                    ‚îÇFinance ‚îÇ
                                                    ‚îÇAPI     ‚îÇ
                                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ WebSocket + REST API
                           ‚îÇ
                           ‚ñº
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ   Frontend     ‚îÇ
                  ‚îÇ   Dashboard    ‚îÇ
                  ‚îÇ   (React)      ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ
                      User Browser
```

### Event-Driven Flow

```
1. News Analyzer (Block 1)
   ‚îú‚îÄ Fetches news from Finnhub every 5 seconds
   ‚îú‚îÄ Filters with Claude AI (significance 0-100)
   ‚îú‚îÄ Saves significant news (>70) to database
   ‚îî‚îÄ Triggers PostgreSQL NOTIFY 'new_significant_news'

2. Signal Extractor (Block 2)
   ‚îú‚îÄ LISTENS to 'new_significant_news'
   ‚îú‚îÄ Analyzes news age and market status
   ‚îú‚îÄ Determines optimal Elliott Wave (0-6)
   ‚îú‚îÄ Generates BUY/SHORT signals with Claude AI
   ‚îú‚îÄ Saves signals to database
   ‚îî‚îÄ Triggers PostgreSQL NOTIFY 'new_trading_signals'

3. Experiment Manager (Block 3)
   ‚îú‚îÄ LISTENS to 'new_trading_signals'
   ‚îú‚îÄ Opens virtual positions (with market timing logic)
   ‚îú‚îÄ Monitors positions every 30 seconds
   ‚îú‚îÄ Closes on stop_loss, take_profit, or max_hold_until
   ‚îî‚îÄ Saves closed positions to experiments table

4. Frontend Dashboard
   ‚îú‚îÄ Fetches active positions every 5 seconds
   ‚îú‚îÄ Shows real-time P&L with current prices
   ‚îú‚îÄ Displays portfolio history with alpha calculation
   ‚îî‚îÄ Connects via WebSocket for instant notifications
```

### Elliott Wave Theory

–°–∏—Å—Ç–µ–º–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∏–¥–µ–µ, —á—Ç–æ –Ω–æ–≤–æ—Å—Ç—å –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–∏—é –≤–æ–ª–Ω —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ —Ä—ã–Ω–∫–µ:

| Wave | Timing | Participants | Characteristics |
|------|--------|--------------|-----------------|
| 0 | 0-5 min | HFT –∞–ª–≥–æ—Ä–∏—Ç–º—ã | –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è, –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å |
| 1 | 5-30 min | Smart money | –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–µ–π–¥–µ—Ä—ã –≤—Ö–æ–¥—è—Ç –ø–µ—Ä–≤—ã–º–∏ |
| 2 | 30-120 min | –ò–Ω—Å—Ç–∏—Ç—É—Ü–∏–æ–Ω–∞–ª—ã | –ö—Ä—É–ø–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏, –º–µ–Ω–µ–µ —à—É–º–∞ |
| 3 | 2-6 —á–∞—Å–æ–≤ | Informed retail | –ü—Ä–æ—á–∏—Ç–∞–ª–∏ –∞–Ω–∞–ª–∏–∑, –¥–µ–ª–∞—é—Ç –≤—ã–≤–æ–¥—ã |
| 4 | 6-24 —á–∞—Å–∞ | Mass retail | –ù–æ–≤–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏–ª–∞—Å—å —à–∏—Ä–æ–∫–æ |
| 5 | 1-3 –¥–Ω—è | –ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ | –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å |
| 6+ | 3-7 –¥–Ω–µ–π | –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç | –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—Ç–æ—Ä–µ/–∏–Ω–¥—É—Å—Ç—Ä–∏–∏ |

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Backend:**
- Python 3.11+
- FastAPI (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫)
- psycopg2 (PostgreSQL –∞–¥–∞–ø—Ç–µ—Ä —Å LISTEN/NOTIFY)
- DSPy (—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö LLM –∑–∞–ø—Ä–æ—Å–æ–≤)
- yfinance, finnhub-python, alpha_vantage (market data)

**Frontend:**
- React 18 (UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
- TypeScript (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript)
- Recharts (–≥—Ä–∞—Ñ–∏–∫–∏ –∏ charts)
- WebSocket API (real-time updates)

**AI/ML:**
- Claude 3.7 Sonnet —á–µ—Ä–µ–∑ OpenRouter API
- DSPy Signatures –¥–ª—è structured outputs
- Chain of Thought reasoning

**Infrastructure:**
- Railway (PaaS –¥–ª—è –¥–µ–ø–ª–æ—è)
- PostgreSQL (managed database)
- GitHub (version control)

---

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ü–æ–ª–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
/Users/derepadmitrij/projs/wavesens/
‚îÇ
‚îú‚îÄ‚îÄ news_analyzer/                    # –ë–õ–û–ö 1: –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # Entry point –¥–ª—è Block 1
‚îÇ   ‚îú‚îÄ‚îÄ config.py                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (API keys, LLM model)
‚îÇ   ‚îú‚îÄ‚îÄ finnhub_client.py             # Finnhub API wrapper
‚îÇ   ‚îú‚îÄ‚îÄ news_significance_llm.py      # Claude AI –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ db.py                         # PostgreSQL NOTIFY trigger
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt              # Python dependencies
‚îÇ
‚îú‚îÄ‚îÄ signal_extractor/                 # –ë–õ–û–ö 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # Entry point –¥–ª—è Block 2
‚îÇ   ‚îú‚îÄ‚îÄ config.py                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Elliott waves, LLM)
‚îÇ   ‚îú‚îÄ‚îÄ wave_analyzer.py              # DSPy + Claude –¥–ª—è wave analysis
‚îÇ   ‚îú‚îÄ‚îÄ db.py                         # PostgreSQL LISTEN + NOTIFY
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt              # Python dependencies
‚îÇ
‚îú‚îÄ‚îÄ experiment_manager/               # –ë–õ–û–ö 3: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # Entry point –¥–ª—è Block 3
‚îÇ   ‚îú‚îÄ‚îÄ config.py                     # Risk management –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ portfolio.py                  # Core trading logic (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô!)
‚îÇ   ‚îú‚îÄ‚îÄ market_data.py                # Yahoo Finance + fallbacks
‚îÇ   ‚îú‚îÄ‚îÄ market_timing.py              # –õ–æ–≥–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ db.py                         # PostgreSQL LISTEN
‚îÇ   ‚îú‚îÄ‚îÄ migrate_experiments.py        # Database migration script
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt              # Python dependencies
‚îÇ
‚îú‚îÄ‚îÄ backend/                          # Backend API Server
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # FastAPI endpoints (Railway deploys THIS!)
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ
‚îú‚îÄ‚îÄ api_server/                       # –°—Ç–∞—Ä—ã–π backend (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Railway)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # –î—É–±–ª–∏–∫–∞—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ
‚îú‚îÄ‚îÄ frontend/                         # React Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html                # HTML entry point (—Å cache-busting)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ manifest.json
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                   # Main React component
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ActivePositions.tsx   # –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (5s updates)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PortfolioHistory.tsx  # –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TradingSignals.tsx    # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ServiceLogs.tsx       # –õ–æ–≥–∏ –≤—Å–µ—Ö 3 –±–ª–æ–∫–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts                # REST API client
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket.ts          # WebSocket connection (FIX: leak)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # TypeScript interfaces
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.tsx                 # React entry point
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json
‚îÇ
‚îú‚îÄ‚îÄ scripts/                          # Utility scripts
‚îÇ   ‚îú‚îÄ‚îÄ migrate_db.py                 # Database setup script
‚îÇ   ‚îú‚îÄ‚îÄ check_positions.py            # Diagnostic tool for positions
‚îÇ   ‚îî‚îÄ‚îÄ close_expired_positions.py    # Manual position closer
‚îÇ
‚îú‚îÄ‚îÄ docs/                             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ COMPLETE_GUIDE.md             # –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è (3177 lines)
‚îÇ   ‚îú‚îÄ‚îÄ FULL_SYSTEM_GUIDE_RU.md       # –≠—Ç–æ—Ç —Ñ–∞–π–ª (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–Ω—ã–π)
‚îÇ   ‚îú‚îÄ‚îÄ RAILWAY_DEPLOY_GUIDE.md       # Railway deployment guide
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md                 # –°—Ç–∞—Ä—ã–π deployment guide
‚îÇ   ‚îî‚îÄ‚îÄ README.md                     # –ö—Ä–∞—Ç–∫–∏–π README
‚îÇ
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ railway.json                      # Railway monorepo configuration
‚îî‚îÄ‚îÄ Procfile                          # Railway process definitions

```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏

#### 1. `experiment_manager/portfolio.py` (1137 —Å—Ç—Ä–æ–∫) - –°–ê–ú–´–ô –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Core trading logic –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

```python
class Portfolio:
    def __init__(self, initial_capital=100000):
        # –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª: $100,000 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π
        # market_data_provider: Yahoo Finance + Finnhub + Alpha Vantage
        # portfolio_snapshots: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

    def open_position(self, signal_data):
        # –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –õ–û–ì–ò–ö–ê:
        # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º market timing (–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º < 2 —á–∞—Å–æ–≤ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è)
        # 2. –í—ã—á–∏—Å–ª—è–µ–º position_size (% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ cash)
        # 3. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –æ—Ç Yahoo Finance
        # 4. –í—ã—á–∏—Å–ª—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ stop_loss –∏ take_profit
        # 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ experiments table
        # 6. –£—á–∏—Ç—ã–≤–∞–µ–º commission (0.1%) –∏ slippage

    def monitor_positions(self):
        # –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        # 1. –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
        # 2. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã
        # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º stop_loss / take_profit / max_hold_until
        # 4. –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏

    def get_positions_at_risk(self):
        # –ë–ê–ì –ë–´–õ –ó–î–ï–°–¨! (–ò–°–ü–†–ê–í–õ–ï–ù)
        # OLD: SELECT * FROM experiments WHERE status = 'active'
        # NEW: SELECT * FROM experiments WHERE status = 'active'
        #      AND max_hold_until < NOW()

    def close_position(self, experiment_id, reason):
        # –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é:
        # 1. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É
        # 2. –í—ã—á–∏—Å–ª—è–µ—Ç P&L (gross_pnl, commission, net_pnl)
        # 3. –í—ã—á–∏—Å–ª—è–µ—Ç alpha vs S&P 500
        # 4. –û–±–Ω–æ–≤–ª—è–µ—Ç cash_balance
        # 5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ experiments —Å status='closed'
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì** (—Å—Ç—Ä–æ–∫–∏ 515-544):

```python
# ‚ùå –ë–ê–ì - –∑–∞–∫—Ä—ã–≤–∞–ª –í–°–ï –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å—Ä–∞–∑—É
def get_positions_at_risk(self) -> List[Dict]:
    cursor.execute("""
        SELECT * FROM experiments WHERE status = 'active'
    """)
    # –≠—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–ª–æ –í–°–ï –ø–æ–∑–∏—Ü–∏–∏, –∏–∑-–∑–∞ —á–µ–≥–æ –æ–Ω–∏ –∑–∞–∫—Ä—ã–≤–∞–ª–∏—Å—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï
def get_positions_at_risk(self) -> List[Dict]:
    cursor.execute("""
        SELECT * FROM experiments
        WHERE status = 'active'
        AND max_hold_until < NOW()
    """)
    # –¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
```

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ Stop Loss / Take Profit** (—Å—Ç—Ä–æ–∫–∏ 267-283):

```python
# Confidence-based stop loss (2-4%)
confidence = float(signal_data.get('confidence', 50))
stop_loss_percent = 2.0 + (confidence / 100.0) * 2.0

# Expected-move-based take profit (1.5x, capped at 8%)
expected_move = float(signal_data.get('expected_move', 3.0))
take_profit_percent = min(expected_move * 1.5, 8.0)

stop_loss_price = entry_price * (1 - stop_loss_percent / 100)
take_profit_price = entry_price * (1 + take_profit_percent / 100)
```

**Market Timing Integration** (—Å—Ç—Ä–æ–∫–∏ 220-250):

```python
from market_timing import calculate_adjusted_max_hold

# –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –µ—Å–ª–∏ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Ä—ã–Ω–∫–∞ < 2 —á–∞—Å–æ–≤
adjusted_max_hold, timing_reason = calculate_adjusted_max_hold(
    entry_time=datetime.now(timezone.utc),
    desired_hold_duration=timedelta(hours=desired_hours),
    min_hold_duration=timedelta(hours=2)
)

if adjusted_max_hold is None:
    logger.warning(f"Cannot open position: {timing_reason}")
    return None
```

#### 2. `signal_extractor/wave_analyzer.py` (227 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: DSPy + Claude AI –¥–ª—è Elliott Wave –∞–Ω–∞–ª–∏–∑–∞

**DSPy Signatures**:

```python
class WaveAnalysisSignature(dspy.Signature):
    """–ê–Ω–∞–ª–∏–∑ –≤–æ–ª–Ω–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –Ω–æ–≤–æ—Å—Ç–∏"""

    # –í—Ö–æ–¥—ã
    headline = dspy.InputField(desc="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏")
    summary = dspy.InputField(desc="–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ")
    news_age_minutes = dspy.InputField(desc="–í–æ–∑—Ä–∞—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö")
    market_status = dspy.InputField(desc="open/closed/weekend/pre_market/after_hours")
    wave_status = dspy.InputField(desc="Status –¥–ª—è –∫–∞–∂–¥–æ–π –≤–æ–ª–Ω—ã 0-6")

    # –í—ã—Ö–æ–¥—ã
    optimal_wave = dspy.OutputField(desc="–ù–æ–º–µ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –≤–æ–ª–Ω—ã (0-10)")
    wave_reasoning = dspy.OutputField(desc="–ü–æ—á–µ–º—É —ç—Ç–∞ –≤–æ–ª–Ω–∞")
    news_type = dspy.OutputField(desc="earnings/macro/regulatory/tech/crypto/other")
    market_impact = dspy.OutputField(desc="high/medium/low")

class SignalGenerationSignature(dspy.Signature):
    """Generate trading signals with BOTH BUY and SHORT"""

    # –í—Ö–æ–¥—ã
    headline = dspy.InputField(desc="News headline")
    summary = dspy.InputField(desc="News summary")
    optimal_wave = dspy.InputField(desc="Optimal wave number")
    wave_start_minutes = dspy.InputField(desc="Start time")
    wave_end_minutes = dspy.InputField(desc="End time")
    news_type = dspy.InputField(desc="News type")

    # –í—ã—Ö–æ–¥—ã
    tickers = dspy.OutputField(desc="Comma-separated tickers (max 5)")
    actions = dspy.OutputField(desc="BUY or SHORT, comma-separated. MUST analyze both directions.")
    expected_moves = dspy.OutputField(desc="Expected % moves")
    confidences = dspy.OutputField(desc="Confidence 0-100 (realistic: 40-80)")
    reasoning = dspy.OutputField(desc="Detailed reasoning for each ticker")
```

**–£–õ–£–ß–®–ï–ù–ò–Ø –í –ü–†–û–ú–ü–¢–ê–•**:

```python
# –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò –¥–ª—è SHORT signals:
"""
1. Analyze both BULLISH and BEARISH implications of the news
2. Use SHORT signals when news is NEGATIVE for a company/sector
3. Use BUY signals when news is POSITIVE for a company/sector
4. Consider:
   - Direct impact on mentioned companies
   - Indirect impact on competitors/suppliers
   - Sector-wide effects
   - Market sentiment shifts
5. Be selective - only high-conviction trades with clear rationale
6. Confidence should reflect realistic probabilities (40-80% typical range)
"""
```

#### 3. `experiment_manager/market_timing.py` (NEW FILE - 150 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Ä—ã–Ω–∫–∞

**–ö–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è**:

```python
def calculate_adjusted_max_hold(
    entry_time: datetime,
    desired_hold_duration: timedelta,
    min_hold_duration: timedelta = timedelta(hours=2)
) -> Tuple[Optional[datetime], str]:
    """
    –°—Ç—Ä–∞—Ç–µ–≥–∏—è:
    1. –ï—Å–ª–∏ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è < 2 —á–∞—Å–æ–≤: –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é
    2. –ï—Å–ª–∏ max_hold –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ: —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ 15 –º–∏–Ω—É—Ç –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
    3. –ò–Ω–∞—á–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∂–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è
    """
    market_close = get_market_close_time(entry_time)
    time_until_close = market_close - entry_time
    safe_close_time = market_close - timedelta(minutes=15)

    if time_until_close < min_hold_duration:
        return None, f"Only {time_until_close} until close, need {min_hold_duration}"

    desired_max_hold = entry_time + desired_hold_duration

    if desired_max_hold > safe_close_time:
        return safe_close_time, "Adjusted to close before market"

    return desired_max_hold, f"Using desired {desired_hold_duration}"
```

#### 4. `experiment_manager/market_data.py` (300+ —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Multi-source price provider —Å fallbacks

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:

```python
class MarketDataProvider:
    def __init__(self):
        self.alpha_vantage_key = os.getenv('ALPHA_VANTAGE_API_KEY')
        self.finnhub_key = os.getenv('FINNHUB_API_KEY')
        self.price_cache = {}  # {ticker: (price, timestamp)}
        self.cache_ttl = 60  # 60 seconds
        self.ticker_blacklist = {}  # {ticker: timestamp}
        self.blacklist_ttl = 3600  # 1 hour

    def get_current_price(self, ticker: str, allow_stale=False) -> Optional[float]:
        # 1. Check blacklist (–µ—Å–ª–∏ —Ç–∏–∫–µ—Ä –Ω–µ–¥–∞–≤–Ω–æ failed)
        # 2. Check cache (–µ—Å–ª–∏ price —Å–≤–µ–∂–∏–π < 60 —Å–µ–∫—É–Ω–¥)
        # 3. Try Yahoo Finance (primary)
        # 4. Try Finnhub (fallback 1)
        # 5. Try Alpha Vantage (fallback 2)
        # 6. Try stale cache if allow_stale=True
        # 7. Add to blacklist if all failed
        # 8. Return None
```

**Blacklist –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–∏–∫–µ—Ä–æ–≤**:

```python
# –ü—Ä–æ–±–ª–µ–º–∞: $TAN –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —Å–æ—Ç–Ω–∏ –æ—à–∏–±–æ–∫
# ERROR - $TAN: possibly delisted; No price data found

# –†–µ—à–µ–Ω–∏–µ: blacklist –Ω–∞ 1 —á–∞—Å
if ticker in self.ticker_blacklist:
    blacklist_age = time.time() - self.ticker_blacklist[ticker]
    if blacklist_age < self.blacklist_ttl:
        logger.debug(f"{ticker} is blacklisted ({blacklist_age/60:.1f}m)")
        return None

# –ü—Ä–∏ failure –¥–æ–±–∞–≤–ª—è–µ–º –≤ blacklist
if price is None:
    self.ticker_blacklist[ticker] = time.time()
    logger.warning(f"‚ùå Failed to get price for {ticker} - blacklisted for 60min")
```

**–ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ Yahoo Finance**:

```python
def _get_price_yahoo(self, ticker: str) -> Optional[float]:
    try:
        # –û—Ç–∫–ª—é—á–∞–µ–º –í–°–ï –ª–æ–≥–∏ yfinance –∏ urllib3
        yf_logger = logging.getLogger('yfinance')
        original_level = yf_logger.level
        yf_logger.setLevel(logging.CRITICAL)

        urllib3_logger = logging.getLogger('urllib3')
        urllib3_original = urllib3_logger.level
        urllib3_logger.setLevel(logging.CRITICAL)

        try:
            stock = yf.Ticker(ticker)
            hist = stock.history(period="1d", interval="1m")
            # ... fetch price ...
        finally:
            # Restore original log levels
            yf_logger.setLevel(original_level)
            urllib3_logger.setLevel(urllib3_original)
    except Exception as e:
        # –ù–µ –ª–æ–≥–∏—Ä—É–µ–º "delisted" –∏–ª–∏ "no price data" (expected errors)
        if 'delisted' not in str(e).lower() and 'no price data' not in str(e).lower():
            logger.debug(f"Yahoo error for {ticker}: {e}")
        return None
```

#### 5. `frontend/src/components/ActivePositions.tsx` (400+ —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

**5-—Å–µ–∫—É–Ω–¥–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:

```typescript
const [positions, setPositions] = useState<Position[]>([]);
const [lastUpdate, setLastUpdate] = useState<Date>(new Date());

useEffect(() => {
  loadPositions();
  const interval = setInterval(loadPositions, 5000);  // 5 seconds
  return () => clearInterval(interval);
}, [apiBaseUrl]);

const loadPositions = async () => {
  try {
    // 1. Fetch active positions
    const response = await fetch(`${apiBaseUrl}/api/positions/active`);
    const data = await response.json();

    // 2. Fetch current prices for all tickers
    const tickers = data.map((p: Position) => p.ticker).join(',');
    const priceRes = await fetch(
      `${apiBaseUrl}/api/market/current-prices?tickers=${tickers}`
    );
    const prices = await priceRes.json();

    // 3. Calculate unrealized P&L for each position
    const enriched = data.map((position: Position) => {
      const currentPrice = prices[position.ticker];
      const unrealizedPnl = (currentPrice - position.entry_price) * position.shares;
      const unrealizedPnlPct = (unrealizedPnl / position.position_size) * 100;

      return {
        ...position,
        current_price: currentPrice,
        unrealized_pnl: unrealizedPnl,
        unrealized_pnl_pct: unrealizedPnlPct
      };
    });

    setPositions(enriched);
    setLastUpdate(new Date());
  } catch (error) {
    console.error('Failed to load positions:', error);
  }
};
```

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å timestamp**:

```typescript
<div style={{ color: '#666' }}>
  üîÑ Updated: {lastUpdate.toLocaleTimeString('en-US', {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  })}
</div>
```

#### 6. `frontend/src/components/PortfolioHistory.tsx` (NEW FILE - 500+ —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å alpha calculation

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∏—á–∏**:

```typescript
interface HistoryPosition {
  id: number;
  ticker: string;
  entry_time: string;
  exit_time: string;
  entry_price: number;
  exit_price: number;
  position_size: number;
  shares: number;
  net_pnl: number;
  return_percent: number;
  sp500_entry: number;
  sp500_exit: number;
  sp500_return: number;
  alpha: number;  // –ù–∞—à–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å - S&P 500 –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
  exit_reason: string;
  elliott_wave: number;
  headline: string;
}

// –§–∏–ª—å—Ç—Ä—ã
const [filter, setFilter] = useState<'all' | 'profit' | 'loss'>('all');

// –ü–∞–≥–∏–Ω–∞—Ü–∏—è
const [currentPage, setCurrentPage] = useState(1);
const itemsPerPage = 10;

// Summary —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
const totalTrades = filteredHistory.length;
const profitableTrades = filteredHistory.filter(p => p.net_pnl > 0).length;
const totalPnL = filteredHistory.reduce((sum, p) => sum + p.net_pnl, 0);
const winRate = (profitableTrades / totalTrades) * 100;
const avgReturn = filteredHistory.reduce((sum, p) => sum + p.return_percent, 0) / totalTrades;
const avgAlpha = filteredHistory.reduce((sum, p) => sum + p.alpha, 0) / totalTrades;
```

#### 7. `frontend/src/services/websocket.ts` (100 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket

**–ë–ê–ì - Connection leak**:

```typescript
// ‚ùå –ë–ê–ì - —Å–æ–∑–¥–∞–≤–∞–ª–∏ –Ω–æ–≤—ã–π WebSocket –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—è —Å—Ç–∞—Ä—ã–π
connect(): Promise<void> {
  this.ws = new WebSocket(this.url);
  // ... setup handlers ...
}

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
connect(): Promise<void> {
  // Close existing connection before creating new one
  if (this.ws && this.ws.readyState !== WebSocket.CLOSED) {
    console.log('Closing existing WebSocket before reconnecting');
    this.ws.close(1000, 'Reconnecting');
  }

  this.ws = new WebSocket(this.url);
  // ... setup handlers ...
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –í Railway –ª–æ–≥–∞—Ö –≤–∏–¥–µ–ª–∏ 8-9 WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ memory leak –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–±—ã—Ç–∏–π.

#### 8. `backend/main.py` (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô!) vs `api_server/main.py`

**–í–ê–ñ–ù–û–ï –û–¢–ö–†–´–¢–ò–ï**: Railway –¥–µ–ø–ª–æ–∏—Ç `backend/main.py`, –∞ –Ω–µ `api_server/main.py`!

**–ò—Å—Ç–æ—Ä–∏—è**:

1. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–ª–∏ `api_server/main.py` —Å API endpoints
2. –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π endpoint `/api/positions/history` –¥–ª—è Portfolio History
3. –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è - 404 –æ—à–∏–±–∫–∞ –Ω–∞ `/api/positions/history`
4. –û–∫–∞–∑–∞–ª–æ—Å—å: Railway configuration —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ `backend/main.py`
5. –†–µ—à–µ–Ω–∏–µ: `cp api_server/main.py backend/main.py`

**railway.json**:

```json
{
  "services": {
    "backend": {
      "startCommand": "cd backend && python3 -m uvicorn main:app --host 0.0.0.0 --port $PORT"
    }
  }
}
```

**–í—Å–µ API endpoints**:

```python
@app.get("/api/positions/active")
async def get_active_positions():
    """–ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏"""

@app.get("/api/positions/history")
async def get_portfolio_history(limit: int = 100):
    """–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π (NEW!)"""

@app.get("/api/signals/recent")
async def get_recent_signals(limit: int = 50):
    """–ù–µ–¥–∞–≤–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã"""

@app.get("/api/market/current-prices")
async def get_current_prices(tickers: str):
    """–¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ç–∏–∫–µ—Ä–æ–≤"""

@app.get("/api/portfolio/snapshot")
async def get_portfolio_snapshot():
    """–¢–µ–∫—É—â–∏–π snapshot –ø–æ—Ä—Ç—Ñ–µ–ª—è"""

@app.get("/api/logs/service")
async def get_service_logs(service: str = None, limit: int = 100):
    """–õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ (news_analyzer, signal_extractor, experiment_manager)"""

@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    """WebSocket –¥–ª—è real-time updates"""
```

#### 9. `frontend/public/index.html`

**–ü—Ä–æ–±–ª–µ–º–∞ browser caching**:

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏, –±—Ä–∞—É–∑–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π JavaScript, –≤—ã–∑—ã–≤–∞—è 404 –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö endpoints.

**–†–µ—à–µ–Ω–∏–µ - cache-busting headers**:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <!-- Prevent caching of this HTML file -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <title>WaveSens Dashboard</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å hard refresh (Ctrl+F5 / Cmd+Shift+R).

---

## API –∫–ª—é—á–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª—é—á–µ–π

#### 1. OPENROUTER_API_KEY

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫ Claude 3.7 Sonnet —á–µ—Ä–µ–∑ OpenRouter

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
- `news_analyzer/config.py` - –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
- `signal_extractor/config.py` - –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

**–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: (—Å–µ–∫—Ä–µ—Ç–Ω–æ–µ, —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Railway)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å**:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://openrouter.ai/
2. –°–æ–∑–¥–∞—Ç—å API key –≤ Dashboard
3. –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å ($5+ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ú–æ–¥–µ–ª—å**: `anthropic/claude-3.7-sonnet`

**–°—Ç–æ–∏–º–æ—Å—Ç—å**:
- Input: ~$3 per 1M tokens
- Output: ~$15 per 1M tokens
- –°—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å: ~2000 input + 1000 output tokens = $0.03

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```python
import os
os.environ['OPENROUTER_API_KEY'] = 'sk-or-v1-...'

import dspy
lm = dspy.LM(
    model="openrouter/anthropic/claude-3.7-sonnet",
    temperature=0.3,
    max_tokens=4000
)
dspy.settings.configure(lm=lm)
```

#### 2. FINNHUB_API_KEY

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Real-time —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
- `news_analyzer/finnhub_client.py` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

**–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: `d367tv1r01qumnp4iltgd367tv1r01qumnp4ilu0`

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å**:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://finnhub.io/
2. –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier: 60 API calls/minute

**API endpoint**:
```
GET https://finnhub.io/api/v1/news?category=general&token={FINNHUB_API_KEY}
```

**–õ–∏–º–∏—Ç—ã**:
- Free tier: 60 calls/minute
- –ú—ã –¥–µ–ª–∞–µ–º 1 call –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ = 12 calls/minute ‚úÖ

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**:

```json
[
  {
    "category": "company news",
    "datetime": 1699999999,
    "headline": "Apple Announces Record Q4 Earnings",
    "id": 123456789,
    "image": "https://...",
    "related": "AAPL",
    "source": "Reuters",
    "summary": "Apple Inc. reported record fourth-quarter earnings...",
    "url": "https://..."
  }
]
```

#### 3. DATABASE_URL

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: PostgreSQL connection string

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
- –í—Å–µ 3 –±–ª–æ–∫–∞ (news_analyzer, signal_extractor, experiment_manager)
- Backend API server
- Migration scripts

**Railway Production**:
```
postgresql://postgres:mOuDnxmRDVGwbbXRjPvCwJNvTKkqmzWv@switchyard.proxy.rlwy.net:37344/railway
```

**Local Development**:
```
postgresql://localhost/wavesens
```

**–§–æ—Ä–º–∞—Ç**:
```
postgresql://[user]:[password]@[host]:[port]/[database]
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```python
import psycopg2
conn = psycopg2.connect(os.getenv('DATABASE_URL'))
cursor = conn.cursor()
```

#### 4. ALPHA_VANTAGE_API_KEY

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Fallback –¥–ª—è market data (–∫–æ–≥–¥–∞ Yahoo Finance fails)

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
- `experiment_manager/market_data.py` - fallback #2 –¥–ª—è —Ü–µ–Ω

**–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**: (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å**:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://www.alphavantage.co/
2. –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier: 25 calls/day (–æ—á–µ–Ω—å –º–∞–ª–æ!)

**–õ–∏–º–∏—Ç—ã**:
- Free: 25 calls/day, 5 calls/minute
- Premium ($50/month): 500 calls/day

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```python
from alpha_vantage.timeseries import TimeSeries

ts = TimeSeries(key=ALPHA_VANTAGE_API_KEY, output_format='pandas')
data, meta_data = ts.get_quote_endpoint(symbol=ticker)
price = float(data['05. price'])
```

#### 5. –î—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**News Analyzer**:

```bash
SIGNIFICANCE_THRESHOLD=70          # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score –¥–ª—è "–∑–Ω–∞—á–∏–º–æ–π" –Ω–æ–≤–æ—Å—Ç–∏
CHECK_INTERVAL_SECONDS=5           # –ö–∞–∫ —á–∞—Å—Ç–æ –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å Finnhub
SKIP_NEWS_OLDER_HOURS=24           # –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ —Å—Ç–∞—Ä—à–µ N —á–∞—Å–æ–≤
MAX_NEWS_PER_CHECK=20              # –ú–∞–∫—Å–∏–º—É–º –Ω–æ–≤–æ—Å—Ç–µ–π –∑–∞ –æ–¥–∏–Ω —Ü–∏–∫–ª
LLM_MODEL=anthropic/claude-3.7-sonnet
LLM_TEMPERATURE=0.3
LOG_LEVEL=INFO
```

**Signal Extractor**:

```bash
LLM_MODEL=anthropic/claude-3.7-sonnet
LLM_TEMPERATURE=0.3
LLM_MAX_TOKENS=4000
LLM_TIMEOUT_SECONDS=30
MIN_EXPECTED_MOVE_PERCENT=1.0      # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–µ–º–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
MIN_CONFIDENCE=40                  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è confidence –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞
MAX_SIGNALS_PER_NEWS=10            # –ú–∞–∫—Å–∏–º—É–º —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç –æ–¥–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏
DEFAULT_STOP_LOSS_PERCENT=2.0      # Default stop loss (—Ç–µ–ø–µ—Ä—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π)
DEFAULT_TAKE_PROFIT_PERCENT=3.0    # Default take profit (—Ç–µ–ø–µ—Ä—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π)
DEFAULT_MAX_HOLD_HOURS=6           # Default max hold time
LOG_LEVEL=INFO
```

**Experiment Manager**:

```bash
INITIAL_CAPITAL=100000             # –ù–∞—á–∞–ª—å–Ω—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
MAX_POSITION_SIZE_PERCENT=5.0      # –ú–∞–∫—Å–∏–º—É–º 5% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞ –Ω–∞ –æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é
MIN_POSITION_SIZE_USD=100          # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
COMMISSION_PERCENT=0.1             # –ö–æ–º–∏—Å—Å–∏—è 0.1% –Ω–∞ —Å–¥–µ–ª–∫—É
SLIPPAGE_PERCENT=0.05              # Slippage 0.05%
MARKET_IMPACT_THRESHOLD=10000      # –ü—Ä–∏ –ø–æ–∑–∏—Ü–∏–∏ > $10k –¥–æ–±–∞–≤–ª—è–µ–º market impact
MONITOR_INTERVAL_SECONDS=30        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
SNAPSHOT_INTERVAL_MINUTES=5        # –°–æ—Ö—Ä–∞–Ω—è–µ–º portfolio snapshot –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
LOG_LEVEL=INFO
```

**Backend API**:

```bash
PORT=8000                          # Railway automatically sets this
HOST=0.0.0.0                       # Listen on all interfaces
```

### –ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Railway

```bash
# 1. Railway CLI
railway login
railway link  # –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç wavesens

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
railway variables set OPENROUTER_API_KEY="sk-or-v1-..."
railway variables set FINNHUB_API_KEY="d367tv1r01qumnp4iltgd367tv1r01qumnp4ilu0"
railway variables set ALPHA_VANTAGE_API_KEY="..."  # optional

# 3. DATABASE_URL —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ Railway –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Postgres

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
railway variables
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ - `.env` —Ñ–∞–π–ª

```bash
# –°–æ–∑–¥–∞—Ç—å .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
touch .env

# –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .env:
OPENROUTER_API_KEY=sk-or-v1-...
FINNHUB_API_KEY=d367tv1r01qumnp4iltgd367tv1r01qumnp4ilu0
DATABASE_URL=postgresql://localhost/wavesens
ALPHA_VANTAGE_API_KEY=...  # optional
LOG_LEVEL=DEBUG

# –ó–∞–≥—Ä—É–∑–∏—Ç—å .env
python3 -c "from dotenv import load_dotenv; load_dotenv()"
```

**–í–ê–ñ–ù–û**: –î–æ–±–∞–≤–∏—Ç—å `.env` –≤ `.gitignore`!

```bash
# .gitignore
.env
.env.local
*.env
```

---

## Railway –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Railway –ø—Ä–æ–µ–∫—Ç–∞

WaveSens –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Railway monorepo** —Å 5 —Å–µ—Ä–≤–∏—Å–∞–º–∏:

```
wavesens (Project)
‚îÇ
‚îú‚îÄ‚îÄ Service: backend
‚îÇ   ‚îú‚îÄ‚îÄ Start Command: cd backend && python3 -m uvicorn main:app --host 0.0.0.0 --port $PORT
‚îÇ   ‚îú‚îÄ‚îÄ URL: https://backend-production-xxxx.up.railway.app
‚îÇ   ‚îî‚îÄ‚îÄ Variables: DATABASE_URL, OPENROUTER_API_KEY, FINNHUB_API_KEY
‚îÇ
‚îú‚îÄ‚îÄ Service: frontend
‚îÇ   ‚îú‚îÄ‚îÄ Start Command: cd frontend && npm start
‚îÇ   ‚îú‚îÄ‚îÄ URL: https://frontend-production-xxxx.up.railway.app
‚îÇ   ‚îî‚îÄ‚îÄ Variables: REACT_APP_API_URL (points to backend URL)
‚îÇ
‚îú‚îÄ‚îÄ Service: news_analyzer (Block 1)
‚îÇ   ‚îú‚îÄ‚îÄ Start Command: cd news_analyzer && python3 main.py
‚îÇ   ‚îú‚îÄ‚îÄ No public URL (background worker)
‚îÇ   ‚îî‚îÄ‚îÄ Variables: DATABASE_URL, OPENROUTER_API_KEY, FINNHUB_API_KEY
‚îÇ
‚îú‚îÄ‚îÄ Service: signal_extractor (Block 2)
‚îÇ   ‚îú‚îÄ‚îÄ Start Command: cd signal_extractor && python3 main.py
‚îÇ   ‚îú‚îÄ‚îÄ No public URL (background worker)
‚îÇ   ‚îî‚îÄ‚îÄ Variables: DATABASE_URL, OPENROUTER_API_KEY
‚îÇ
‚îú‚îÄ‚îÄ Service: experiment_manager (Block 3)
‚îÇ   ‚îú‚îÄ‚îÄ Start Command: cd experiment_manager && python3 main.py
‚îÇ   ‚îú‚îÄ‚îÄ No public URL (background worker)
‚îÇ   ‚îî‚îÄ‚îÄ Variables: DATABASE_URL, FINNHUB_API_KEY, ALPHA_VANTAGE_API_KEY
‚îÇ
‚îî‚îÄ‚îÄ Database: PostgreSQL
    ‚îú‚îÄ‚îÄ Automatically provisioned by Railway
    ‚îú‚îÄ‚îÄ DATABASE_URL automatically injected into all services
    ‚îî‚îÄ‚îÄ Host: switchyard.proxy.rlwy.net:37344
```

### railway.json –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "numReplicas": 1,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### Procfile –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

**backend/Procfile**:
```
web: cd backend && python3 -m uvicorn main:app --host 0.0.0.0 --port $PORT
```

**frontend/Procfile**:
```
web: cd frontend && npm start
```

**news_analyzer/Procfile**:
```
worker: cd news_analyzer && python3 main.py
```

**signal_extractor/Procfile**:
```
worker: cd signal_extractor && python3 main.py
```

**experiment_manager/Procfile**:
```
worker: cd experiment_manager && python3 main.py
```

### Deployment –ø—Ä–æ—Ü–µ—Å—Å

**1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Railway**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Railway CLI
npm install -g @railway/cli

# –õ–æ–≥–∏–Ω
railway login

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
railway init

# –°–≤—è–∑–∞—Ç—å —Å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º
railway link
```

**2. –°–æ–∑–¥–∞–Ω–∏–µ PostgreSQL database**

```bash
# –í Railway Dashboard:
# 1. Click "New" ‚Üí "Database" ‚Üí "PostgreSQL"
# 2. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç DATABASE_URL
# 3. DATABASE_URL –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
```

**3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**

```bash
# –î–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
railway variables set OPENROUTER_API_KEY="sk-or-v1-..."
railway variables set FINNHUB_API_KEY="d367tv1r01qumnp4iltgd367tv1r01qumnp4ilu0"

# –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
railway service  # –í—ã–±—Ä–∞—Ç—å frontend
railway variables set REACT_APP_API_URL="https://backend-production-xxxx.up.railway.app"
```

**4. Deploy –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**

```bash
# Auto-deploy –ø—Ä–∏ push –≤ GitHub (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
git add .
git commit -m "Your changes"
git push origin main
# Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

# –ò–ª–∏ manual deploy —á–µ—Ä–µ–∑ CLI
railway up
```

**5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è**

```bash
# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
railway logs --service backend
railway logs --service news_analyzer

# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
railway logs --follow

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
railway status
```

### Troubleshooting Railway deployment

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Service crashes immediately after deploy**

```bash
# –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
# ERROR: Could not find OPENROUTER_API_KEY

# –†–µ—à–µ–Ω–∏–µ:
railway service  # –í—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å
railway variables set OPENROUTER_API_KEY="sk-or-v1-..."
railway restart
```

**–ü—Ä–æ–±–ª–µ–º–∞ 2: Frontend –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Backend**

```bash
# –ü—Ä–∏—á–∏–Ω–∞: REACT_APP_API_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π

# –†–µ—à–µ–Ω–∏–µ:
railway service  # –í—ã–±—Ä–∞—Ç—å frontend
railway variables set REACT_APP_API_URL="https://backend-production-xxxx.up.railway.app"
railway restart
```

**–ü—Ä–æ–±–ª–µ–º–∞ 3: Database connection refused**

```bash
# –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
# psycopg2.OperationalError: could not connect to server

# –†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DATABASE_URL
railway variables | grep DATABASE_URL

# –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ PostgreSQL —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω
railway status

# –†–µ—à–µ–Ω–∏–µ 3: Recreate database
# –í Railway Dashboard: Database ‚Üí Settings ‚Üí Delete
# –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π PostgreSQL —Å–µ—Ä–≤–∏—Å
```

**–ü—Ä–æ–±–ª–µ–º–∞ 4: Build fails with "No Python version specified"**

```bash
# –ü—Ä–∏—á–∏–Ω–∞: Railway –Ω–µ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–µ—Ä—Å–∏—é Python

# –†–µ—à–µ–Ω–∏–µ 1: –°–æ–∑–¥–∞—Ç—å runtime.txt
echo "python-3.11" > runtime.txt
git add runtime.txt
git commit -m "Specify Python version"
git push

# –†–µ—à–µ–Ω–∏–µ 2: –î–æ–±–∞–≤–∏—Ç—å –≤ railway.json
{
  "build": {
    "builder": "NIXPACKS",
    "nixpacksPlan": {
      "phases": {
        "setup": {
          "nixPkgs": ["python311"]
        }
      }
    }
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞ 5: Service runs locally but fails on Railway**

```bash
# –ü—Ä–∏—á–∏–Ω–∞: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å requirements.txt
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–æ–π requirements.txt

# news_analyzer/requirements.txt
psycopg2-binary==2.9.9
finnhub-python==2.4.19
dspy-ai==2.4.0
openai>=1.0.0
python-dotenv==1.0.0

# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
cd news_analyzer
pip install -r requirements.txt
python3 main.py  # Test locally first
```

### URLs –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**Production (Railway)**:

```
Frontend:         https://frontend-production-xxxx.up.railway.app
Backend API:      https://backend-production-xxxx.up.railway.app
PostgreSQL:       switchyard.proxy.rlwy.net:37344
```

**Local Development**:

```
Frontend:         http://localhost:3000
Backend API:      http://localhost:8000
PostgreSQL:       localhost:5432
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Railway –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# Terminal 1: Backend logs
railway logs --service backend --follow

# Terminal 2: News Analyzer logs
railway logs --service news_analyzer --follow

# Terminal 3: Signal Extractor logs
railway logs --service signal_extractor --follow

# Terminal 4: Experiment Manager logs
railway logs --service experiment_manager --follow

# Terminal 5: Database metrics
railway database metrics
```

### Railway pricing

**Current usage**:
- 5 services √ó $5/month = $25/month
- PostgreSQL database: $10/month
- Total: ~$35/month

**Free tier alternative** (—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏):
- 500 hours/month execution time (shared across all services)
- 100GB network egress
- 1GB database storage

---

